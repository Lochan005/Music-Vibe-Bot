<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LLM Music Finder</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 700px;
      margin: 3rem auto;
      padding: 1rem;
      color: #222;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    input, button {
      padding: 0.75rem;
      width: 100%;
      font-size: 1rem;
      margin-top: 0.5rem;
      box-sizing: border-box;
    }
    button {
      background-color: #1db954;
      color: white;
      border: none;
      cursor: pointer;
      margin-bottom: 1rem;
    }
    button:hover {
      background-color: #17a74a;
    }
    .track {
      margin: 1rem 0;
      padding: 0.75rem;
      border-left: 4px solid #1db954;
      background: #f9f9f9;
    }
    .track strong {
      font-size: 1.1rem;
    }
    #status {
      margin: 1rem 0;
      font-style: italic;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>ðŸŽµ LLM Music Search</h1>

  <label for="prompt">Describe the kind of music you want:</label>
  <input type="text" id="prompt" placeholder="e.g., Chill songs for a rainy evening" />
  <button type="button" onclick="searchMusic()">Find Songs</button>

  <div id="status"></div>
  <div id="results"></div>

  <script>
    async function searchMusic() {
      const prompt = document.getElementById("prompt").value.trim();
      const resultsDiv = document.getElementById("results");
      const statusDiv = document.getElementById("status");

      resultsDiv.innerHTML = "";
      statusDiv.innerText = "Interpreting your request...";

      if (!prompt) {
        statusDiv.innerText = "Please enter a music description.";
        return;
      }

      try {
        const interpretRes = await fetch("http://127.0.0.1:8000/interpret", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });

        const interpretData = await interpretRes.json();
        const parsed_query = interpretData.parsed_query;
        console.log("Parsed query:", parsed_query);

        if (!parsed_query) {
          statusDiv.innerText = "The AI couldn't interpret your request.";
          return;
        }

        statusDiv.innerText = `Searching Spotify for: "${parsed_query}"`;

        const searchRes = await fetch(`http://127.0.0.1:8000/search?query=${encodeURIComponent(parsed_query)}`);
        const data = await searchRes.json();
        console.log("Fetched track data:", data);

        const tracks = data.tracks?.items || [];

        if (tracks.length === 0) {
          statusDiv.innerText = "No matching tracks found.";
          return;
        }

        statusDiv.innerText = `Found ${tracks.length} track${tracks.length > 1 ? "s" : ""}:`;

        tracks.forEach(track => {
          const div = document.createElement("div");
          div.className = "track";
          div.innerHTML = `
            <strong>${track.name}</strong><br>
            by ${track.artists.map(a => a.name).join(", ")}<br>
            <a href="${track.external_urls.spotify}" target="_blank">Listen on Spotify</a>
          `;
          resultsDiv.appendChild(div);
        });

      } catch (err) {
        console.error(err);
        statusDiv.innerText = "Something went wrong. Check the console for details.";
      }
    }
  </script>
</body>
</html>
